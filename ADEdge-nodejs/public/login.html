<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link id="favicon" rel="icon" type="image/png" href="resources/adsetups-dark.png" sizes="14x14" />
  <title>Sign in â€“ ADEdge</title>
  <style>
    :root {
      --bg: radial-gradient(circle at top, #0f172a 0%, #020617 40%, #020617 100%);
      --accent: #0ea5a4;
      --text-dark: #0f172a;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 26px;
    }
    .shell {
      display: grid;
      grid-template-columns: 1.05fr 0.95fr;
      max-width: 1180px;
      width: 100%;
      background: rgba(2,6,23,0.15);
      border: 1px solid rgba(148,163,184,0.15);
      border-radius: 26px;
      overflow: hidden;
      backdrop-filter: blur(18px);
      box-shadow: 0 24px 60px rgba(0,0,0,0.35);
      min-height: 540px;
    }
    /* LEFT */
    .hero {
      background: radial-gradient(circle at 10% 10%, rgba(14,165,164,0.9) 0%, rgba(2,6,23,0) 55%), radial-gradient(circle at 95% 80%, rgba(125,211,252,0.75) 0%, rgba(2,6,23,0) 65%), rgba(2,6,23,0.15);
      color: #e2e8f0;
      padding: 30px 32px 32px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .branding {
      display: flex;
      align-items: center;
      gap: .55rem;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: -.01em;
    }
    .logo-img {
      width: 32px;
      height: 32px;
      object-fit: contain;
      display: block;
      background: none;
      border-radius: 0;
    }
    .hero h1 {
      font-size: 2.1rem;
      margin: 8px 0 6px;
      line-height: 1.05;
    }
    .hero p {
      max-width: 420px;
      color: rgba(226,232,240,0.8);
      font-size: .9rem;
    }
    .hero-metric {
      margin-top: auto;
      display: flex;
      gap: 16px;
    }
    .hero-box {
      background: rgba(15,23,42,0.22);
      border: 1px solid rgba(148,163,184,0.25);
      border-radius: 16px;
      padding: 12px 14px 10px;
      min-width: 140px;
    }
    .hero-box small {
      font-size: .62rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: rgba(226,232,240,0.5);
    }
    .hero-box strong {
      display: block;
      font-size: 1.5rem;
      margin-top: 3px;
      line-height: 1;
    }
    .hero-box span {
      font-size: .7rem;
      color: rgba(226,232,240,0.7);
    }
    /* RIGHT */
    .card {
      background: #fff;
      padding: 34px 30px 26px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .card-title h2 {
      margin: 0;
      font-size: 1.7rem;
      color: #0f172a;
    }
    .card-title p {
      margin: 6px 0 0;
      color: #6b7280;
      font-size: .9rem;
    }
    form label {
      display: block;
      font-size: .8rem;
      margin-bottom: 6px;
      color: #0f172a;
      font-weight: 600;
    }
    .input-wrap {
      position: relative;
    }
    input[type=text],
    input[type=password] {
      width: 100%;
      padding: 12px 40px 12px 40px;
      border: 1px solid #d1d5db;
      border-radius: 16px;
      font-size: .9rem;
      transition: border .12s ease-out, box-shadow .12s ease-out;
      background: #fff;
    }
    input:focus {
      outline: none;
      border: 1px solid rgba(61,138,245,0.65);
      box-shadow: 0 0 0 3px rgba(61,138,245,0.1);
    }
    .input-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      opacity: .45;
    }
    /* show/hide button */
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: 0;
      font-size: .68rem;
      color: #6b7280;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 6px;
    }
    .toggle-password:hover {
      background: rgba(99,102,241,0.04);
      color: #0f172a;
    }

    button[type=submit] {
      margin-top: 10px;
      width: 100%;
      padding: 11px;
      border-radius: 16px;
      border: 0;
      font-weight: 600;
      background: #3D8AF5;
      color: #fff;
      cursor: pointer;
      font-size: .9rem;
      transition: background-color .12s ease-out;
      box-shadow: 0 8px 22px rgba(61,138,245,0.3);
    }
    button[type=submit]:hover:not([disabled]) {
      background: #5B9CF5;
    }
    button[disabled] {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }
    .status {
      min-height: 20px;
      font-size: .7rem;
    }
    .error { color: #b91c1c; }
    .success { color: #047857; }

    /* bottom register */
    .register-inline-bottom {
      margin-top: auto;
      font-size: .8rem;
      color: #6b7280;
      text-align: center;
      background: rgba(61,138,245,0.05);
      border: 1px solid rgba(61,138,245,0.08);
      border-radius: 12px;
      padding: 9px 10px 10px;
    }
    .register-inline-bottom a {
      color: #3D8AF5;
      text-decoration: none;
      font-weight: 600;
      margin-left: 4px;
    }
    .register-inline-bottom a:hover {
      text-decoration: underline;
    }

    @media (max-width: 980px) {
      .shell {
        grid-template-columns: 1fr;
        max-width: 560px;
      }
      .hero {
        display: none;
      }
      .card {
        border-radius: 20px;
      }
    }
  </style>
</head>
<body>
  <main class="shell" role="main" aria-label="ADEdge login">
    <!-- LEFT PANEL -->
    <section class="hero" aria-label="ADEdge intro">
      <div class="branding">
        <img src="https://files.catbox.moe/qcb3nu.webp" alt="ADEdge" class="logo-img">
        ADEdge CDN
      </div>
      <div>
        <h1>Welcome back ðŸ‘‹</h1>
        <p>Start uploading your images on ADEdge again.</p>
      </div>
      <div class="hero-metric">
        <div class="hero-box" aria-label="Platform uptime">
          <small>Platform uptime</small>
          <strong>99.9%</strong>
          <span>monitored</span>
        </div>
      </div>
    </section>

    <!-- RIGHT PANEL -->
    <section class="card" aria-label="Sign in form">
      <div class="card-title">
        <h2>Sign in</h2>
        <p>Use your ADEdge account to continue.</p>
      </div>

      <form id="loginForm" novalidate>
        <div class="input-group">
          <label for="username">Username</label>
          <div class="input-wrap">
            <svg class="input-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4
              v1h16v-1c0-2.66-5.33-4-8-4"/>
            </svg>
            <input id="username" name="username" type="text" autocomplete="username" required aria-required="true" placeholder="e.g. anton.edge" />
          </div>
        </div>

        <div class="input-group" style="margin-top: 14px;">
          <label for="password">Password</label>
          <div class="input-wrap">
            <svg class="input-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="currentColor" d="M17 8h-1V6a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v9a2 2 0 0 0 2
              2h10a2 2 0 0 0 2-2v-9a2 2 0 0 0-2-2M9 6a3 3 0 0 1 6 0v2H9zm8 13H7v-9h10z"/>
            </svg>
            <input id="password" name="password" type="password" autocomplete="current-password" required aria-required="true" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
            <button type="button" id="togglePassword" class="toggle-password" aria-label="Show password">Show</button>
          </div>
        </div>

        <button id="loginBtn" type="submit">Log in</button>
        <div id="loginStatus" class="status" aria-live="polite"></div>
      </form>

      <div class="register-inline-bottom">
        New to ADEdge?
        <a href="/register">Register here</a>
      </div>
    </section>
  </main>

  <script>
  (function(){
    'use strict';

    function el(id){ return document.getElementById(id); }

    function setStatus(msg, cls){
      const s = el('loginStatus');
      if(!s) return;
      s.textContent = msg || '';
      s.className = 'status';
      if(cls === 'error') s.classList.add('error');
      if(cls === 'success') s.classList.add('success');
    }

    async function attemptLogin(username, password, timeoutMs = 10000){
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeoutMs);
      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify({ username, password }),
          signal: controller.signal
        });

        const text = await res.text();
        let body = null;
        try { body = text ? JSON.parse(text) : null; }
        catch(e) { body = text; }

        return { ok: res.ok, status: res.status, body };
      } catch(err) {
        if(err.name === 'AbortError') return { ok:false, status:0, error:'Request timed out' };
        return { ok:false, status:0, error: err.message || String(err) };
      } finally { clearTimeout(id); }
    }

    document.addEventListener('DOMContentLoaded', function(){
      const form = el('loginForm');
      const usernameEl = el('username');
      const passwordEl = el('password');
      const loginBtn = el('loginBtn');
      const togglePasswordBtn = el('togglePassword');

      if(!form || !usernameEl || !passwordEl || !loginBtn){
        console.error('Missing login elements');
        setStatus('Internal error: missing elements.', 'error');
        return;
      }

      // show/hide password
      if (togglePasswordBtn && passwordEl) {
        togglePasswordBtn.addEventListener('click', function () {
          const isPassword = passwordEl.type === 'password';
          passwordEl.type = isPassword ? 'text' : 'password';
          togglePasswordBtn.textContent = isPassword ? 'Hide' : 'Show';
          togglePasswordBtn.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
        });
      }

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        setStatus('', null);

        const username = (usernameEl.value || '').trim();
        const password = passwordEl.value || '';
        if(!username || !password){
          setStatus('Please fill in both username and password.', 'error');
          return;
        }

        loginBtn.disabled = true;
        const origText = loginBtn.textContent;
        loginBtn.textContent = 'Signing you in...';

        const res = await attemptLogin(username, password);

        if(!res.ok){
          let msg = '';
          if(res.error) msg = res.error;
          else if(res.body){
            if(typeof res.body === 'object')
              msg = res.body.error || res.body.message || JSON.stringify(res.body);
            else msg = String(res.body);
          } else msg = 'Status ' + res.status;

          if(res.status === 401 || res.status === 403)
            msg = 'Invalid username or password.';

          setStatus('Login failed: ' + msg, 'error');
          loginBtn.disabled = false;
          loginBtn.textContent = origText;
          return;
        }

        setStatus('Login successful â€” redirecting...', 'success');

        let redirectTo = '/dashboard';
        try {
          const body = res.body && typeof res.body === 'object'
            ? res.body
            : JSON.parse(res.body || '{}');

          if (body.redirect) redirectTo = body.redirect;
          else if (body.location) redirectTo = body.location;
        } catch (e) {
          console.warn('Login response parse error:', e);
        }

        setTimeout(() => {
          window.location.href = redirectTo;
        }, 250);
      });

      fetch('/healthz', { credentials: 'same-origin' })
        .then(r => console.log('/healthz', r.status))
        .catch(e => {
          console.warn('/healthz failed', e);
          setStatus('The server is currently unreachable.', 'error');
        });
    });
  })();
  </script>
</body>
</html>
